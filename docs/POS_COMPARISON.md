# مقایسه DLL و پروتکل مستقیم (pos.py)

## خلاصه

| ویژگی | DLL (`pna.pcpos.dll`) | پروتکل مستقیم (`pos.py`) |
|-------|----------------------|-------------------------|
| **هدف** | ارتباط با کارت‌خوان | ارتباط با کارت‌خوان |
| **روش** | استفاده از توابع آماده | پیاده‌سازی مستقیم پروتکل |
| **سازنده** | پرداخت نوین | ما (بر اساس مستندات) |
| **سیستم‌عامل** | فقط Windows | همه (Windows, Linux, Mac) |
| **وابستگی** | نیاز به DLL و pythonnet | فقط pyserial |
| **سادگی** | ساده‌تر (توابع آماده) | پیچیده‌تر (باید پروتکل را بنویسیم) |
| **کنترل** | کمتر (DLL را نمی‌بینیم) | بیشتر (کد را می‌بینیم) |
| **پشتیبانی** | رسمی از پرداخت نوین | خودمان باید پشتیبانی کنیم |

## تفاوت‌های اصلی

### 1. نحوه استفاده

#### با DLL:
```python
# ساده - فقط صدا می‌زنیم
pos = PCPOS()
pos.Amount = 50000
pos.send_transaction()
response = pos.GetParsedResp()
```

#### بدون DLL (pos.py):
```python
# پیچیده‌تر - باید خودمان پروتکل را بنویسیم
request = "R0000000050000PR00AM0000000050000..."
response = send_command(request)
parsed = parse_response(response)
```

### 2. توابع موجود

#### DLL شامل:
- ✅ `send_transaction` - تراکنش اصلی
- ✅ `send_transaction_bill_payment` - پرداخت قبض
- ✅ `send_transaction_charge` - شارژ
- ✅ `send_transaction_Trx_Cancel` - لغو
- ✅ `TestConnection` - تست اتصال
- ✅ `GetParsedResp` - پاسخ پارس شده
- ✅ و 20+ تابع دیگر...

#### pos.py شامل:
- ✅ `initiate_payment` - شروع پرداخت
- ✅ `verify_payment` - تایید پرداخت
- ✅ `get_payment_status` - وضعیت پرداخت
- ⚠️ توابع دیگر باید اضافه شوند

### 3. فرمت پیام‌ها

#### DLL:
- فرمت پیام را خودش مدیریت می‌کند
- شما فقط Properties را تنظیم می‌کنید
- DLL خودش پیام را می‌سازد

#### pos.py:
- ما باید فرمت پیام را خودمان بسازیم
- بر اساس مستندات PDF:
  ```
  R{amount}PR00AM{amount}TE{terminal}SO{order}...
  ```

### 4. پردازش پاسخ

#### DLL:
- `GetParsedResp()` پاسخ را پارس می‌کند
- `GetTrxnRRN()` شماره مرجع را می‌دهد
- `GetTrxnSerial()` سریال تراکنش را می‌دهد

#### pos.py:
- ما باید خودمان پاسخ را پارس کنیم
- بر اساس تگ‌ها: `RS`, `SR`, `RN`, `TI`, `PN`, `DS`, `TM`

## کدام را استفاده کنیم؟

### استفاده از DLL اگر:
- ✅ در Windows هستید
- ✅ DLL را دارید
- ✅ می‌خواهید ساده‌تر باشد
- ✅ می‌خواهید پشتیبانی رسمی داشته باشید

### استفاده از pos.py اگر:
- ✅ در Linux/Mac هستید
- ✅ DLL ندارید
- ✅ می‌خواهید کنترل بیشتری داشته باشید
- ✅ می‌خواهید مستقل باشید

## نتیجه‌گیری

**هر دو یک کار را انجام می‌دهند** اما:
- **DLL** = راه ساده‌تر و رسمی
- **pos.py** = راه مستقل و قابل کنترل

در پروژه ما، **هر دو پیاده‌سازی شده** و می‌توانید انتخاب کنید!

